<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Guest Payment → Create Booking</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    fieldset { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    legend { padding: 0 8px; font-weight: 600; }
    label { display: block; margin: 8px 0 4px; font-weight: 600; }
    input, select { width: 100%; padding: 8px; box-sizing: border-box; }
    .row { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .btn { padding: 10px 14px; border-radius: 6px; border: 0; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #3CBEEE; color: #fff; }
    .btn-secondary { background: #e9ecef; }
    .muted { color: #6c757d; font-size: 12px; }
    pre { background: #0d1117; color: #c9d1d9; padding: 12px; border-radius: 8px; overflow: auto; }
    .inline { display: inline-flex; gap: 8px; align-items: center; }
  </style>
  <script>
    function randomOrderCode() {
      const now = new Date();
      const pad = (n) => n.toString().padStart(2, '0');
      const yyyy = now.getFullYear();
      const mm = pad(now.getMonth() + 1);
      const dd = pad(now.getDate());
      const HH = pad(now.getHours());
      const MM = pad(now.getMinutes());
      const SS = pad(now.getSeconds());
      const rand = Math.floor(Math.random() * 100000).toString().padStart(5, '0');
      return `ORD-${yyyy}${mm}${dd}-${HH}${MM}${SS}-${rand}`;
    }

    function uuidLike() {
      if (window.crypto && 'randomUUID' in window.crypto) {
        return window.crypto.randomUUID();
      }
      return `${Date.now()}-${Math.random().toString(16).slice(2)}`;
    }

    async function submitBooking(ev) {
      ev.preventDefault();
      const base = document.getElementById('baseUrl').value.replace(/\/$/, '');
      const url = `${base}/api/bookings/create.php`;

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const visitDate = document.getElementById('visitDate').value.trim();

      const zone1 = document.getElementById('zone1').value;
      const date1 = document.getElementById('date1').value;
      const qty1 = parseInt(document.getElementById('qty1').value || '0', 10);

      const zone2 = document.getElementById('zone2').value;
      const date2 = document.getElementById('date2').value;
      const qty2 = parseInt(document.getElementById('qty2').value || '0', 10);

      const cart = [];
      if (qty1 > 0 && date1) cart.push({ zoneCode: zone1, visitDate: date1, quantity: qty1 });
      if (qty2 > 0 && date2) cart.push({ zoneCode: zone2, visitDate: date2, quantity: qty2 });

      const payload = {
        orderCode: randomOrderCode(),
        customer: { name, email, phone, visitDate },
        cart,
      };

      const headers = {
        'Content-Type': 'application/json',
        'Idempotency-Key': uuidLike(),
      };

      const out = document.getElementById('output');
      out.textContent = 'Requesting...';
      try {
        const res = await fetch(url, { method: 'POST', headers, body: JSON.stringify(payload) });
        const text = await res.text();
        out.textContent = `HTTP ${res.status}\n\n` + text;
      } catch (e) {
        out.textContent = 'Request failed: ' + (e && e.message ? e.message : e);
      }
    }
  </script>
</head>
<body>
  <h1>Test Guest Payment → Create Booking</h1>
  <p class="muted">Use this form to POST a booking to the backend and verify DB writes.</p>

  <form onsubmit="submitBooking(event)">
    <fieldset>
      <legend>Backend URL</legend>
      <label for="baseUrl">Public API Base</label>
      <input id="baseUrl" type="text" value="http://localhost/keansburg-park/backend/public" />
      <div class="muted">Final endpoint: {base}/api/bookings/create.php</div>
    </fieldset>

    <fieldset>
      <legend>Customer</legend>
      <div class="row">
        <div>
          <label for="name">Full Name</label>
          <input id="name" type="text" value="John Tester" required />
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" type="email" value="john.tester@example.com" required />
        </div>
        <div>
          <label for="phone">Phone</label>
          <input id="phone" type="tel" value="(555) 000-0000" />
        </div>
        <div>
          <label for="visitDate">Visit Date</label>
          <input id="visitDate" type="date" required />
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Cart</legend>
      <div class="row">
        <div>
          <label for="zone1">Item 1 Zone</label>
          <select id="zone1">
            <option value="PARK">PARK</option>
            <option value="WATER">WATER</option>
          </select>
        </div>
        <div>
          <label for="date1">Item 1 Date</label>
          <input id="date1" type="date" />
        </div>
        <div>
          <label for="qty1">Item 1 Quantity</label>
          <input id="qty1" type="number" min="0" value="2" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="zone2">Item 2 Zone</label>
          <select id="zone2">
            <option value="PARK">PARK</option>
            <option value="WATER" selected>WATER</option>
          </select>
        </div>
        <div>
          <label for="date2">Item 2 Date</label>
          <input id="date2" type="date" />
        </div>
        <div>
          <label for="qty2">Item 2 Quantity</label>
          <input id="qty2" type="number" min="0" value="8" />
        </div>
      </div>
      <div class="muted">Tip: Set total quantity ≥ 10 to see 10% discount applied.</div>
    </fieldset>

    <div class="inline">
      <button class="btn btn-primary" type="submit">Create Booking</button>
      <button class="btn btn-secondary" type="button" onclick="document.getElementById('output').textContent=''">Clear Output</button>
    </div>
  </form>

  <h3>Response</h3>
  <pre id="output"></pre>
</body>
</html>


